try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(!Nabu.prototype.DragAndDrop){Nabu.DragAndDrop=function(){}}Nabu.DragAndDrop.Container=function(a,b){this.events=new Nabu.EventPool();this.object=a;this.inner=$(a).find(".drag-caret").get(0);this.object.dadContainer=this;this.touchSupport="ontouchend" in document;this.dropObjects=new Array();this.dragObject=null;this.dropContainer=null;this.init()};Nabu.DragAndDrop.Container.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){var a=this;if(this.object!==false){if(this.touchSupport){$(this.object).on("touchmove",function(b){console.log("DragItem.touchmove");return a.dragMove(b)});$(document.body).on("touchend",function(b){console.log("DragItem.touchend");return a.dragEnd(b)})}else{$(this.object).on("mousemove",function(b){return a.dragMove(b)});$(document.body).on("mouseup",function(b){return a.dragEnd(b)})}}},addDropContainer:function(a){this.dropObjects.push(a)},translateCoordinates:function(a,c){var b=this.inner.getBoundingClientRect();return{x:a-b.left,y:c-b.top}},setDragObject:function(b,a,f){this.dragObject=b;var d=$(this.dragObject.object).parent(".drop-container");if(d.length>0){var c=d.get(0);if(c.dropContainer){this.dropContainer=c.dropContainer}else{this.cancelDropContainer()}}},dragMove:function(b){if(this.dragObject!==null){this.dragObject.dragMove(b);var a=this.getBestQualifiedDropObject(b.clientX,b.clientY);if(a instanceof Nabu.DragAndDrop.DropContainer){if(this.dropContainer instanceof Nabu.DragAndDrop.DropContainer&&this.dropContainer!==a){console.log("remove Drop Container");this.dropContainer.dragOut(b);this.dropContainer=a}this.dropContainer.dragOver(b)}}return true},dragEnd:function(b){if(this.dragObject!==null){var a=this.dragObject.dragEnd(b);if(this.dropContainer!==null){this.dropContainer.drop(this.dragObject,b.clientX,b.clientY)}this.dragObject=null;return a}return true},getBestQualifiedDropObject:function(a,f){var d=null;for(i in this.dropObjects){var b=this.dropObjects[i];var c=b.object.getBoundingClientRect();if(c.left<=a&&c.right>=a&&c.top<=f&&c.bottom>=f){if(d===null||$.contains(d.object,b.object)){d=b}}}return d},cancelDropContainer:function(){if(this.dropContainer instanceof Nabu.DragAndDrop.DropContainer){this.dropContainer.dragOut()}}};Nabu.DragAndDrop.DragItem=function(a,b,c){this.events=new Nabu.EventPool();this.container=a;this.object=b;this.object.dragItem=this;this.item=null;this.touchSupport="ontouchend" in document;this.dragging=false;this.draginit=false;this.dragAnchor=null;this.dragCoordinates={ox:0,oy:0,dx:0,dy:0,width:0,height:0};this.init()};Nabu.DragAndDrop.DragItem.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){var b=this;if(this.object!==false){var a=$(this.object).find(".drag-item");if(a.length>0){this.item=a.get(0)}else{this.item=this.object}if(this.touchSupport){$(this.item).on("touchstart",function(c){console.log("DragItem.touchstart");return b.dragStart(c)})}else{$(this.item).on("mousedown",function(c){return b.dragStart(c)})}}},dragStart:function(c){this.draginit=true;var b=this.object.getBoundingClientRect();var a=this.container.translateCoordinates(b.left,b.top);this.dragCoordinates.ox=a.x;this.dragCoordinates.oy=a.y;this.dragCoordinates.dx=c.clientX-b.left;this.dragCoordinates.dy=c.clientY-b.top;this.dragCoordinates.width=b.width;this.dragCoordinates.height=b.height;this.dragging=true;this.container.setDragObject(this,c.clientX,c.clientY);c.preventDefault();c.stopPropagation();return false},dragMove:function(b){if(this.dragging){if(this.draginit){$(this.object).addClass("dragging");this.dragAnchor=document.createElement("SPAN");this.dragAnchor.style.display="hidden";this.object.parentNode.replaceChild(this.dragAnchor,this.object);this.container.inner.appendChild(this.object);this.object.style.width=this.dragCoordinates.width+"px";this.object.style.height=this.dragCoordinates.height+"px";this.draginit=false;if(this.container.dropContainer instanceof Nabu.DragAndDrop.DropContainer){this.container.dropContainer.moveInterstitial(b.clientX,b.clientY)}}var a=this.container.translateCoordinates(b.clientX,b.clientY);this.object.style.left=(a.x-this.dragCoordinates.dx)+"px";this.object.style.top=(a.y-this.dragCoordinates.dy)+"px"}return true},dragEnd:function(b){if(this.dragging){if(this.dragAnchor!==null){var a=this.dragAnchor.parentNode;this.container.inner.removeChild(this.object);a.replaceChild(this.object,this.dragAnchor);this.dragAnchor=null}$(this.object).removeClass("dragging");$(this.object).removeAttr("style");this.dragging=false;b.preventDefault();b.stopPropagation()}},};Nabu.DragAndDrop.DropContainer=function(a,b,c){this.events=new Nabu.EventPool();this.container=a;this.container.addDropContainer(this);this.object=b;this.object.dropContainer=this;this.touchSupport="ontouchend" in document;this.interstitial=null;this.init()};Nabu.DragAndDrop.DropContainer.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){var a=this;if(this.object!==false){if(this.touchSupport){}else{}}},dragOver:function(a){this.moveInterstitial(a.clientX,a.clientY)},dragOut:function(a){if(this.interstitial!==null){this.object.removeChild(this.interstitial);this.interstitial=null}},drop:function(b,a,c){if(this.interstitial!==null){if(b instanceof Nabu.DragAndDrop.DragItem&&b.object!==null){this.object.replaceChild(b.object,this.interstitial);this.interstitial=null}else{this.object.removeChild(this.interstitial);this.interstitial=null}}},moveInterstitial:function(j,h){if(this.interstitial===null){this.interstitial=document.createElement("DIV");this.interstitial.className="interstitial";var f=this.container.dragObject;var a=f.object.getBoundingClientRect();this.interstitial.style.width="100%";this.interstitial.style.height=a.height+"px";$(this.object).prepend(this.interstitial)}var g=this.object.children;var l={object:null,bounds:null};var d={object:null,bounds:null};var k={object:null,bounds:null};for(var c=0;c<g.length;c++){var b=g.item(c);var a=b.getBoundingClientRect();if(a.left<=j&&a.right>=j&&a.top<=h&&a.bottom>=h){k.object=b;k.bounds=a;break}if(a.top>h){if(d.object===null||d.bounds.top>a.top){d.object=b;d.bounds=a}}if(a.bottom<h){if(l.object===null||l.bounds.bottom<a.bottom){l.object=b;l.bounds=a}}}if(k.object!==null){if(k.object!==this.interstitial){this.object.insertBefore(this.interstitial,k.object.nextSibling)}}else{if(l.object!==null){this.object.insertBefore(this.interstitial,l.object.nextSibling)}else{if(d.object!==null){this.object.insertBefore(this.interstitial,d.object)}}}}};nabu.registerLibrary("DragAndDrop",["Event"]);