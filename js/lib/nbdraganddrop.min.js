try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(!Nabu.prototype.DragAndDrop){Nabu.DragAndDrop=function(){}}Nabu.DragAndDrop.Container=function(a,b){this.events=new Nabu.EventPool();this.object=a;this.inner=$(a).find(".tree-inner").get(0);this.object.dadContainer=this;this.touchSupport="ontouchend" in document;this.dropObjects=new Array();this.dragObject=null;this.init()};Nabu.DragAndDrop.Container.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){var a=this;if(this.object!==false){if(this.touchSupport){$(this.object).on("touchmove",function(b){console.log("DragItem.touchmove");return a.dragMove(b)});$(document.body).on("touchend",function(b){console.log("DragItem.touchend");return a.dragEnd(b)})}else{$(this.object).on("mousemove",function(b){return a.dragMove(b)});$(document.body).on("mouseup",function(b){return a.dragEnd(b)})}}},addDropContainer:function(a){this.dropObjects.push(a)},translateCoordinates:function(a,c){var b=this.inner.getBoundingClientRect();return{x:a-b.left,y:c-b.top}},setDragObject:function(a){this.dragObject=a},dragMove:function(b){if(this.dragObject!==null){this.dragObject.dragMove(b);var a=this.getBestQualifiedDropObject(b);console.log(a)}return true},dragEnd:function(b){if(this.dragObject!==null){var a=this.dragObject.dragEnd(b);this.dragObject=null;return a}return true},getBestQualifiedDropObject:function(f){var a=f.clientX;var g=f.clientY;var d=null;for(i in this.dropObjects){var b=this.dropObjects[i];var c=b.object.getBoundingClientRect();if(c.left<=a&&c.right>=a&&c.top<=g&&c.bottom>=g){if(d===null||$.contains(d.object,b.object)){d=b}}}return d}};Nabu.DragAndDrop.DragItem=function(a,b,c){this.events=new Nabu.EventPool();this.container=a;this.object=b;this.object.dragItem=this;this.touchSupport="ontouchend" in document;this.dragging=false;this.draginit=false;this.dragAnchor=null;this.dragCoordinates={ox:0,oy:0,dx:0,dy:0,width:0,height:0};this.init()};Nabu.DragAndDrop.DragItem.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){var a=this;if(this.object!==false){if(this.touchSupport){$(this.object).on("touchstart",function(b){console.log("DragItem.touchstart");return a.dragStart(b)})}else{$(this.object).on("mousedown",function(b){return a.dragStart(b)})}}},dragStart:function(c){this.draginit=true;var b=this.object.getBoundingClientRect();var a=this.container.translateCoordinates(b.left,b.top);this.dragCoordinates.ox=a.x;this.dragCoordinates.oy=a.y;this.dragCoordinates.dx=c.clientX-b.left;this.dragCoordinates.dy=c.clientY-b.top;this.dragCoordinates.width=b.width;this.dragCoordinates.height=b.height;this.dragging=true;this.container.setDragObject(this)},dragMove:function(b){if(this.dragging){if(this.draginit){$(this.object).addClass("dragging");this.dragAnchor=document.createElement("SPAN");this.dragAnchor.style.display="hidden";this.object.parentNode.replaceChild(this.dragAnchor,this.object);this.container.inner.appendChild(this.object);this.object.style.width=this.dragCoordinates.width+"px";this.object.style.height=this.dragCoordinates.height+"px";this.draginit=false}var a=this.container.translateCoordinates(b.clientX,b.clientY);this.object.style.left=(a.x-this.dragCoordinates.dx)+"px";this.object.style.top=(a.y-this.dragCoordinates.dy)+"px"}return true},dragEnd:function(b){if(this.dragging){if(this.dragAnchor!==null){var a=this.dragAnchor.parentNode;this.container.inner.removeChild(this.object);a.replaceChild(this.object,this.dragAnchor);this.dragAnchor=null}$(this.object).removeClass("dragging");$(this.object).removeAttr("style");this.dragging=false;b.preventDefault();b.stopPropagation()}},};Nabu.DragAndDrop.DropContainer=function(a,b,c){this.events=new Nabu.EventPool();this.container=a;this.container.addDropContainer(this);this.object=b;this.touchSupport="ontouchend" in document;this.init()};Nabu.DragAndDrop.DropContainer.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){var a=this;if(this.object!==false){if(this.touchSupport){}else{}}},dragOver:function(a){}};nabu.registerLibrary("DragAndDrop",["Event"]);