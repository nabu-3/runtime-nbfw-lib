try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(!Nabu.prototype.DragAndDrop){Nabu.DragAndDrop=function(){}}Nabu.DragAndDrop.DragItem=function(a,b){console.log("new DragItem object");this.events=new Nabu.EventPool();this.touchSupport="ontouchend" in document;this.touchCaret=null;this.object=a;this.init()};Nabu.DragAndDrop.DragItem.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){if(this.object!==false&&Nabu.DragAndDrop.isDraggableObject(this.object)){this.object.dragControl=this;if(this.touchSupport){this.object.ontouchstart=this.onTouchStart;this.object.ontouchmove=this.onTouchMove;this.object.ontouchend=this.onTouchEnd}else{this.object.onselectstart=this.onSelectStart;this.object.ondragstart=this.onDragStart;this.object.ondragend=this.onDragEnd}}},onSelectStart:function(a){if(!a){var a=window.event}if(a.currentTarget.dragDrop){a.currentTarget.dragDrop();return false}},onDragStart:function(b){console.log("onDragStart");if(!b){var b=window.event}var a=Nabu.DragAndDrop.getControlObject(this);if(a!==null){a.dragStart(b,b.target,b.clientX,b.clientY,b.pageX,b.pageY)}},dragStart:function(g,f,c,a,d,b){console.log(this.events.fireEvent("beforeDragStart",{draggable:f}));if(!this.events.isEventTargeted("beforeDragStart")||this.events.fireEvent("beforeDragStart",{draggable:f})===true){Nabu.DragAndDrop.draggingObject=f;if(this.touchSupport){this.touchCaret=f.cloneNode(true);wow.addClassName(this.touchCaret,"dragcaret");document.body.appendChild(this.touchCaret);document.body.dragControl=this;var h=f.getBoundingClientRect();this.touchCaretDelta.x=h.left-c;this.touchCaretDelta.y=h.top-a;this.touchCaret.style.top=b+this.touchCaretDelta.y+"px";this.touchCaret.style.left=d+this.touchCaretDelta.x+"px"}try{g.dataTransfer.setData("Text",$(g.target).data("id"))}catch(g){console.log(g)}$(f).addClass("dragging");this.events.fireEvent("onDragStart",{draggable:f})}return true},onDragEnd:function(b){if(!b){var b=window.event}var a=Nabu.DragAndDrop.getControlObject(this);if(a!==null){a.dragEnd(b)}},dragEnd:function(a){$(this.object).removeClass("dragging");this.events.fireEvent("onDragEnd",{draggable:this.object});Nabu.DragAndDrop.draggingObject=null;if(a.currentTarget!==a.originalTarget){this.draggingObject=null}if(this.touchCaret!==null){this.touchCaret.remove();this.touchCaret=null}document.body.dragControl=null},};Nabu.DragAndDrop.DropContainer=function(a,b){console.log("new DropContainer object");this.events=new Nabu.EventPool();this.object=a;this.interstitialObject=null;this.touchSupport="ontouchend" in document;this.init()};Nabu.DragAndDrop.DropContainer.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){if(this.object!==false){this.object.dragControl=this;this.interstitialObject=document.createElement("div");if(this.interstitialClass!==null){this.interstitialObject.className=this.interstitialClass}if(this.touchSupport){}else{}this.object.ondragover=this.onDragOver;this.object.ondragleave=this.onDragLeave;this.object.ondrop=this.onDrop;document.body.addEventListener("dragover",this.onMouseMove)}},onMouseMove:function(b){if(!b){var b=window.event}var a=Nabu.DragAndDrop.getControlObject(this);if(a!==null&&a.touchCaret){a.touchCaret.style.left=(b.clientX+a.touchCaretDelta.x)+"px";a.touchCaret.style.top=(b.clientY+a.touchCaretDelta.y)+"px"}},onDragOver:function(b){if(!b){var b=window.event}var a=Nabu.DragAndDrop.getControlObject(this);if(a!==null){a.dragOver(b,b.clientX,b.clientY)}},dragOver:function(d,c,b){if(this.object!==null&&Nabu.DragAndDrop.isDraggableObject(d.target)){var a=d.target;if(Nabu.DragAndDrop.areCompatibles(a,this.object)){d.preventDefault();$(this.object).addClass("drag-enter");this.events.fireEvent("onDragOver",{draggable:d.target});return true}}return false},onDragLeave:function(c){if(!c){var c=window.event}var b=Nabu.DragAndDrop.getControlObject(this);if(b!==null&&b.object!==null&&Nabu.DragAndDrop.isDraggableObject(c.target)){var a=c.target;if(Nabu.DragAndDrop.areCompatibles(a,b.object)){c.preventDefault();$(b.object).removeClass("drag-enter");b.events.fireEvent("onDragLeave",{draggable:a,droppable:this.object})}}},onDrop:function(b){if(!b){var b=window.event}var a=Nabu.DragAndDrop.getControlObject(this);if(a!==null&&Nabu.DragAndDrop.draggingObject!==null){b.preventDefault();a.drop(b,Nabu.DragAndDrop.draggingObject)}},drop:function(l,o){if(this.object!==null&&Nabu.DragAndDrop.isDraggableObject(o)){l.preventDefault();var k=this.matchingGroup(o,this.object);if(k!==false){$(this.object).removeClass("drag-enter");$(o).removeClass("dragging");var c=(o.attributes["drag-action"]?o.attributes["drag-action"].value:null);var j=(o.attributes["drag-mode"]?o.attributes["drag-mode"].value:"move");var a=(o.attributes["data-id"]?o.attributes["data-id"].value:null);var d=(this.object.attributes["data-drop-id"]?this.object.attributes["data-drop-id"].value:null);var i=this.getNextSiblingDraggable(this.interstitialObject);var b=(i!==null&&i.attributes["data-id"]?i.attributes["data-id"].value:null);var h=this.getPreviousSiblingDraggable(this.interstitialObject);var g=(h!==null&&h.attributes["data-id"]?h.attributes["data-id"].value:null);var m=this.object;var f=(m!==null&&m.attributes["data-drop-id"]?m.attributes["data-drop-id"].value:null);var n=this.events.fireEvent("onDrop",this,{draggable:o,droppable:this.object,draggableFrom:m,draggableFromId:f,dragAction:c,dragMode:j,dragId:a,dropId:d,dragGroup:k,dragPriorId:g,dragNextId:b});if(j==="move"){if(n===true){this.insertDroppedElement(this.object,o)}else{if(n!==false){if(typeof n==="object"){this.insertDroppedElement(this.object,n)}else{this.insertDroppedElement(this.object,o)}}}}return true}}return false},insertDroppedElement:function(f,a){if(f.sortable===true&&a.attributes["drag-order"]){var b=a.attributes["drag-order"].value*1;for(var d=f.firstChild;d!==null;d=this.getNextSiblingDraggable(d)){if(d instanceof HTMLElement&&d.attributes["drag-order"]){var c=d.attributes["drag-order"].value*1;if(b<c){f.insertBefore(a,d);return true}}}}if(this.interstitialObject.parentElement===f){f.replaceChild(a,this.interstitialObject)}else{f.appendChild(a)}},appendDraggableObject:function(b,a){var c=wow.get(b);if(c!==false){if(Nabu.DragAndDrop.isDraggableObject(c)){if(this.draggableObjects.indexOf(c)<0){c.dragControl=this;if(this.touchSupport){c.ontouchstart=this.onTouchStart;c.ontouchmove=this.onTouchMove;c.ontouchend=this.onTouchEnd}else{c.onselectstart=this.onSelectStart;c.ondragstart=this.onDragStart;c.ondragover=this.onDragOver;c.ondragend=this.onDragEnd;c.ondrop=this.onDrop}this.draggableObjects.push(c)}}else{if(a!==undefined&&a===true){for(c=c.firstElementChild;c!==null;c=c.nextSibling){if(c instanceof HTMLElement){this.appendDraggableObject(c,true)}}}}}},getPreviousSiblingDraggable:function(a){if(a===null){return null}for(var b=a.previousSibling;b!==null;b=b.previousSibling){if(Nabu.DragAndDrop.isDraggableObject(b)){return b}}return null},getNextSiblingDraggable:function(a){if(a===null){return null}for(var b=a.nextSibling;b!==null;b=b.nextSibling){if(Nabu.DragAndDrop.isDraggableObject(b)){return b}}return null},matchingGroup:function(a,g){var b=g.attributes["drag-group"]?g.attributes["drag-group"].value.split(" "):null;var d=a.attributes["drag-group"]?a.attributes["drag-group"].value.split(" "):null;if(b===null&&d===null){return true}if(b===null||d===null){return false}for(var f=0;f<b.length;f++){for(var c=0;c<d.length;c++){if(b[f]===d[c]){return b[f]}}}return false}};Nabu.DragAndDrop.draggingObject=null;Nabu.DragAndDrop.getControlObject=function(a){if(a instanceof Nabu.DragAndDrop.DragItem||a instanceof Nabu.DragAndDrop.DropContainer){return a}if(a.dragControl){return a.dragControl}if(a.parentElement!==null){return Nabu.DragAndDrop.getControlObject(a.parentElement)}return null};Nabu.DragAndDrop.areCompatibles=function(a,g){var b=g.attributes["drag-group"]?g.attributes["drag-group"].value.split(","):null;var d=a.attributes["drag-group"]?a.attributes["drag-group"].value.split(","):null;if(b===null&&d===null){return true}if(b===null||d===null){return false}for(var f=0;f<b.length;f++){for(var c=0;c<d.length;c++){if(b[f]===d[c]){return true}}}return false};Nabu.DragAndDrop.isDraggableObject=function(a){return(a!==null&&a.hasAttributes&&a.hasAttributes()&&a.attributes.draggable&&a.attributes.draggable.value==="true")};nabu.registerLibrary("DragAndDrop",["Event"]);