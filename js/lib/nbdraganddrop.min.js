try{if(!Nabu)throw"Nabu Manager not loaded"}catch(t){throw"Nabu Manager not loaded"}Nabu.prototype.DragAndDrop||(Nabu.DragAndDrop=function(){}),Nabu.DragAndDrop.Container=function(t,e){this.events=new Nabu.EventPool,this.object=t,this.inner=$(t).find(".dad-inner").get(0),this.object.dadContainer=this,this.touchSupport="ontouchend"in document,this.dropObjects=new Array,this.dragObject=null,this.dropContainer=null,this.init()},Nabu.DragAndDrop.Container.prototype={addEventListener:function(t){this.events.addEventListener(t)},removeEventListener:function(t){this.events.removeEventListener(t)},init:function(){var t=this;!1!==this.object&&(this.touchSupport?($(this.object).on("touchmove",function(e){return console.log("DragItem.touchmove"),t.dragMove(e)}),$(document.body).on("touchend",function(e){return console.log("DragItem.touchend"),t.dragEnd(e)})):($(this.object).on("mousemove",function(e){return t.dragMove(e)}),$(document.body).on("mouseup",function(e){return t.dragEnd(e)})))},addDropContainer:function(t){this.dropObjects.push(t)},translateCoordinates:function(t,e){var i=this.inner.getBoundingClientRect();return{x:t-i.left,y:e-i.top}},setDragObject:function(t,e,i){this.dragObject=t;var n=$(this.dragObject.object).parent(".drop-container");if(n.length>0){var o=n.get(0);o.dropContainer?this.dropContainer=o.dropContainer:this.cancelDropContainer()}},dragMove:function(t){if(null!==this.dragObject){
//$(this.object).find('.drag-over').removeClass('drag-over');
this.dragObject.dragMove(t);var e=this.getBestQualifiedDropObject(t.clientX,t.clientY);e instanceof Nabu.DragAndDrop.DropContainer&&(this.dropContainer instanceof Nabu.DragAndDrop.DropContainer&&this.dropContainer!==e&&(this.dropContainer.dragOut(t),this.dropContainer=e),this.dropContainer.dragOver(t))}return!0},dragEnd:function(t){if(null!==this.dragObject){var e=this.dragObject.dragEnd(t);
//$(this.object).find('.drag-over').removeClass('drag-over');
return null!==this.dropContainer&&this.dropContainer.drop(this.dragObject,t.clientX,t.clientY),this.dragObject=null,e}return!0},getBestQualifiedDropObject:function(t,e){var n=null;for(i in this.dropObjects){var o=this.dropObjects[i],r=o.object.getBoundingClientRect();r.left<=t&&r.right>=t&&r.top<=e&&r.bottom>=e&&(null===n||$.contains(n.object,o.object))&&(n=o)}return n},cancelDropContainer:function(){this.dropContainer instanceof Nabu.DragAndDrop.DropContainer&&this.dropContainer.dragOut()}},Nabu.DragAndDrop.DragItem=function(t,e,i){this.events=new Nabu.EventPool,this.container=t,this.object=e,this.object.dragItem=this,this.touchSupport="ontouchend"in document,this.dragging=!1,this.draginit=!1,this.dragAnchor=null,this.dragCoordinates={ox:0,oy:0,dx:0,dy:0,width:0,height:0},this.init()},Nabu.DragAndDrop.DragItem.prototype={addEventListener:function(t){this.events.addEventListener(t)},removeEventListener:function(t){this.events.removeEventListener(t)},init:function(){var t=this;!1!==this.object&&(this.touchSupport?$(this.object).on("touchstart",function(e){return console.log("DragItem.touchstart"),t.dragStart(e)}):$(this.object).on("mousedown",function(e){return t.dragStart(e)}))},dragStart:function(t){this.draginit=!0;var e=this.object.getBoundingClientRect(),i=this.container.translateCoordinates(e.left,e.top);return this.dragCoordinates.ox=i.x,this.dragCoordinates.oy=i.y,this.dragCoordinates.dx=t.clientX-e.left,this.dragCoordinates.dy=t.clientY-e.top,this.dragCoordinates.width=e.width,this.dragCoordinates.height=e.height,this.dragging=!0,this.container.setDragObject(this,t.clientX,t.clientY),t.preventDefault(),t.stopPropagation(),!1},dragMove:function(t){if(this.dragging){this.draginit&&($(this.object).addClass("dragging"),this.dragAnchor=document.createElement("SPAN"),this.dragAnchor.style.display="hidden",this.object.parentNode.replaceChild(this.dragAnchor,this.object),this.container.inner.appendChild(this.object),this.object.style.width=this.dragCoordinates.width+"px",this.object.style.height=this.dragCoordinates.height+"px",this.draginit=!1,this.container.dropContainer instanceof Nabu.DragAndDrop.DropContainer&&this.container.dropContainer.moveInterstitial(t.clientX,t.clientY));var e=this.container.translateCoordinates(t.clientX,t.clientY);this.object.style.left=e.x-this.dragCoordinates.dx+"px",this.object.style.top=e.y-this.dragCoordinates.dy+"px"}return!0},dragEnd:function(t){if(this.dragging){if(null!==this.dragAnchor){var e=this.dragAnchor.parentNode;this.container.inner.removeChild(this.object),e.replaceChild(this.object,this.dragAnchor),this.dragAnchor=null}$(this.object).removeClass("dragging"),this.object.style.width=null,this.object.style.height=null,this.object.style.left=null,this.object.style.top=null,this.dragging=!1,t.preventDefault(),t.stopPropagation()}}},Nabu.DragAndDrop.DropContainer=function(t,e,i){this.events=new Nabu.EventPool,this.container=t,this.container.addDropContainer(this),this.object=e,this.object.dropContainer=this,this.touchSupport="ontouchend"in document,this.interstitial=null,this.dragObject=null,this.init()},Nabu.DragAndDrop.DropContainer.prototype={addEventListener:function(t){this.events.addEventListener(t)},removeEventListener:function(t){this.events.removeEventListener(t)},init:function(){!1!==this.object&&this.touchSupport},dragOver:function(t){this.moveInterstitial(t.clientX,t.clientY)},dragOut:function(t){null!==this.interstitial&&(this.object.removeChild(this.interstitial),this.interstitial=null),null!==this.dragObject&&($(this.dragObject).removeClass("drag-over"),this.dragObject=null)},drop:function(t,e,i){if(null!==this.interstitial){var n=$(t);if(t instanceof Nabu.DragAndDrop.DragItem&&null!==t.object){var n=$(this.interstitial).next('[draggable="true"]'),o=$(this.interstitial).prev('[draggable="true"]'),r=$(this.interstitial).closest(".drag-item"),s={drag:t.object,drop:this.object,parent:r.length>0?r[0]:null,before:n.length>0?n[0]:null,after:o.length>0?o[0]:null};this.container.events.fireEvent("onBeforeDrop",this.container,s)&&(this.object.replaceChild(t.object,this.interstitial),this.interstitial=null,this.container.events.fireEvent("onDrop",this.container,s))}null!==this.interstitial&&(this.object.removeChild(this.interstitial),this.interstitial=null,this.container.events.fireEvent("onError",this.container))}null!==this.dragObject&&($(this.dragObject).removeClass("drag-over"),this.dragObject=null)},moveInterstitial:function(t,e){if(null===this.interstitial){this.interstitial=document.createElement("DIV"),this.interstitial.className="dad-interstitial";var i=this.container.dragObject,n=i.object.getBoundingClientRect();this.interstitial.style.width="100%",this.interstitial.style.height=n.height+"px",$(this.object).prepend(this.interstitial)}for(var o=this.object.children,r={object:null,bounds:null},s={object:null,bounds:null},a={object:null,bounds:null},h=0;h<o.length;h++){var d=o.item(h),n=d.getBoundingClientRect();if(n.left<=t&&n.right>=t&&n.top<=e&&n.bottom>=e){a.object=d,a.bounds=n;break}n.top>e&&(null===s.object||s.bounds.top>n.top)&&(s.object=d,s.bounds=n),n.bottom<e&&(null===r.object||r.bounds.bottom<n.bottom)&&(r.object=d,r.bounds=n)}null!==a.object?a.object!==this.interstitial&&(e<a.bounds.y+a.bounds.height/2?this.object.insertBefore(this.interstitial,a.object):this.object.insertBefore(this.interstitial,a.object.nextSibling),this.dragObject=a.object,$(a.object).addClass("drag-over")):null!==r.object?(this.object.insertBefore(this.interstitial,r.object.nextSibling),this.dragObject=r.object,$(r.object).addClass("drag-over")):null!==s.object?(this.object.insertBefore(this.interstitial,s.object),this.dragObject=s.object,$(s.object).addClass("drag-over")):console.log("No drag over")}},nabu.registerLibrary("DragAndDrop",["Event"]);