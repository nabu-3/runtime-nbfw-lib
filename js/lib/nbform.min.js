try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(typeof Nabu.UI==="undefined"){Nabu.UI=function(){}}Nabu.UI.Form=function(a,b){this.events=new Nabu.EventPool();this.container=a;this.params=b;this.form=null;this.fields=new Array();this.formaction=null;this.maskActions={id:null,name:null};this.submit_object=null;this.validate=true;this.init()};Nabu.UI.Form.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(a){var c=this;var b=null;if(this.container.tagName==="FORM"){b=this.container}else{if($(this.container).find("form").length>0){b=$(this.container).find("form").get(0)}else{if($(this.container).closest("form").length>0){b=$(this.container).closest("form").get(0)}}}if(typeof a==="undefined"){a=false}if(b){this.form=b;b.nabuForm=this;if(!a){$(b).on("submit",function(d){return c.onSubmit(d.originalEvent)})}this.locateFields(a);if(!a){setTimeout(function(){c.init(true)},1000)}}},locateFields:function(c){for(var f in this.form.elements){var b=null;if(f!=="attributes"&&f!=="elements"&&f!=="childNodes"&&f!=="children"&&f!=="properties"&&f!=="all"){var d=this.form[f];if(d!==null&&d!==""&&d!==true&&typeof d==="object"&&(d instanceof Element||d instanceof NodeList||d instanceof HTMLCollection)){if(d instanceof HTMLInputElement||d instanceof HTMLSelectElement||d instanceof HTMLTextAreaElement){b=d}else{if(d instanceof HTMLButtonElement){b=d}else{if(d instanceof NodeList){b=d}else{if(d instanceof HTMLCollection){b=d}}}}if(b!==null){var a=(d.name&&d.name.length>0?d.name:f);if(c!==true){d.nabuForm=false}this.appendField(a,d)}}}}},appendField:function(f,d){var b,c=false;if(d instanceof NodeList){for(b=0;b<d.length;b++){if(!d.nabuForm){this.connectFieldObject(d[b]);c=true}}}else{if(d instanceof HTMLCollection){for(b=0;b<d.length;b++){if(!d.nabuForm){this.connectFieldObject(d.item(b));c=true}}}else{if(!d.nabuForm){this.connectFieldObject(d);c=true}}}if(c===true){if(this.fields[f]){if(this.fields[f].object instanceof Array){if(this.fields[f].object.indexOf(d)<0){this.fields[f].object.push(d)}}else{if(this.fields[f].object!==d){this.fields[f].object=[this.fields[f].object];if(this.fields[f].object.indexOf(d)<0){this.fields[f].object.push(d)}}}}else{this.fields[f]={object:d,trigger:3,actions:null,touched:false,visible:true,enabled:true}}if(!(d instanceof HTMLButtonElement)&&!(d instanceof HTMLInputElement&&(d.type==="button"||d.type==="submit"||d.type==="image"||d.type==="hidden"))){var a=this.validateField(f);this.setFieldStatusClass(f,a)}this.resetActionsFlag();this.applyActionsForField(f);this.validateSameFields(f);this.validateForm()}},connectFieldObject:function(b){var c=this;b.nabuForm=this;if(b instanceof HTMLSelectElement){$(b).on("change",function(d){return c.onChangeField(d.originalEvent)})}else{if(b instanceof HTMLInputElement){var a=b.type.toLowerCase();switch(a){case"text":case"number":case"date":case"time":case"datetime":case"email":case"password":case"file":$(b).on("change",function(d){return c.onChangeField(d.originalEvent)}).on("blur",function(d){return c.onBlurField(d.originalEvent)}).on("focus",function(d){return c.onFocusField(d.originalEvent)});this.applyPlaceholder(b,false);break;case"button":case"submit":case"image":case"checkbox":$(b).on("click",function(d){return c.onClickField(d.originalEvent)});break;case"radio":$(b).on("click",function(d){return c.onClickField(d.originalEvent)});if(b.checked){$(b.parentElement).addClass(this.active_class)}break;case"hidden":$(b).on("change",function(d){return c.onChangeField(d.originalEvent)});break;default:$(b).on("blur",function(d){return c.onBlurField(d.originalEvent)})}if(this.params.validation==="live"){$(b).on("keyup",function(d){return c.onKeyUp(d.originalEvent)})}}else{if(b instanceof HTMLTextAreaElement){$(b).on("change",function(d){return c.onChangeField(d.originalEvent)}).on("blur",function(d){return c.onBlurField(d.originalEvent)}).on("focus",function(d){return c.onFocusField(d.originalEvent)});if(this.params.validation==="live"){$(b).on("keyup",function(d){return c.onKeyUp(d.originalEvent)})}}else{if(b instanceof HTMLButtonElement){$(b).on("click",function(d){return c.onClickField(d.originalEvent)})}else{$(b).on("blur",function(d){return c.onBlurField(d.originalEvent)})}}}}},isAvailableField:function(a){var d=(this.params.evaluate==="visible"?false:true);if(this.fields[a]){if(this.fields[a].object instanceof NodeList||this.fields[a].object instanceof Array){for(var c in this.fields[a].object){d=d||nabu.isObjectVisible(this.fields[a].object[c].parentElement)}}else{if(this.fields[a].object instanceof HTMLCollection){for(var b=0;b<this.fields[a].object.length;b++){d=d||nabu.isObjectVisible(this.fields[a].object.item(b).parentElement)}}else{d=d||nabu.isObjectVisible(this.fields[a].object.parentElement)}}}return d},getFieldValue:function(a){var c=null;if(this.fields[a]){var d=this.fields[a];if(d.object instanceof NodeList||d.object instanceof Array){c=new Array();for(var b=0;b<d.object.length;b++){if(d.object[b].checked||d.object[b].selected){c.push(d.object[b].value)}}if(c.length===0){c=null}else{if(c.length===1){c=c.shift()}}}else{if(d.object instanceof HTMLCollection){c=new Array();for(var b=0;b<d.object.length;b++){if(d.object.item(b).checked||d.object.item(b).selected){c.push(d.object.item(b).value)}}if(c.length===0){c=null}else{if(c.length===1){c=c.shift()}}}else{if(d.object instanceof HTMLSelectElement){if(d.object.selectedIndex>-1){c=d.object[d.object.selectedIndex].value}}else{if(d.object instanceof HTMLInputElement||d.object instanceof HTMLTextAreaElement){if(d.object.attributes.type&&d.object.attributes.type.value==="radio"&&d.object.attributes.name&&this.form!==null){c=this.getRadioValue(this.form[d.object.attributes.name.value],null)}else{if(d.object.attributes.type&&d.object.attributes.type.value==="checkbox"&&!d.object.checked){c=$(d.object).data("valueUnchecked")}else{c=d.object.value}}if(nabu.getNavigatorName()==="MSIE"&&d.object.attributes.placeholder&&d.object.attributes.placeholder===c){c=""}}}}}}return c},getRadioValue:function(b,a){for(i=0;i<b.length;i++){if(b[i].checked){return b[i].value}}return a},evaluateField:function(b){if(this.fields[b]){var a=this.validateField(b);this.setFieldStatusClass(b,a);this.resetActionsFlag();this.applyActionsForField(b);this.validateSameFields(b);this.validateForm();if(a===0){return false}}return true},fieldFollowsForm:function(c,b,a){if(c===null){return true}switch(b){case"active":this.applyMask(c,{enabled:a,visible:null});break;case"visible":this.applyMask(c,{enabled:null,visible:a});break;default:throw"Unknown data-form-follow type ["+b+"]"}return true},validateField:function(c){var b=3;if(this.fields[c]){if(this.fields[c].object instanceof NodeList||this.fields[c].object instanceof Array){b=0;for(var d=0;d<this.fields[c].object.length;d++){var f=this.fields[c].object[d];var a=this.validateFieldPart(f);if(a>b){b=a}}}else{if(this.fields[c].object instanceof HTMLCollection){b=0;for(var d=0;d<this.fields[c].object.length;d++){var f=this.fields[c].object.item(d);var a=this.validateFieldPart(f);if(a>b){b=a}}}else{var f=this.fields[c].object;b=this.validateFieldPart(f)}}this.fields[c].trigger=b}return b},validateFieldPart:function(j){var b=3;var d=(j.attributes&&j.attributes["data-form-mandatory"]?j.attributes["data-form-mandatory"].value:"none");var h=(j.attributes&&j.attributes["data-form-rule"]?j.attributes["data-form-rule"].value:"none");var a=(j.attributes&&j.attributes["data-form-rule-param"]?j.attributes["data-form-rule-param"].value:null);var k=j.value;if(nabu.getNavigatorName()==="MSIE"&&j.attributes.placeholder&&j.attributes.placeholder.value===k){k=""}if(h!=="none"){if(d==="yes"){b=0}else{b=(k.length===0?1:0)}var c=h.split(":");var g=c===null?h:c[0];switch(g){case"filled":if(k.length>0&&(!j.attributes["data-unselected-value"]||j.attributes["data-unselected-value"].value!==k)){b=2}break;case"regex":if(k.length>0){c=RegExp("("+a+")").exec(k);if(c!==null&&c.length>=2&&c[1].length===k.length){b=2}}break;case"uri":if(c.length===2){switch(c[1]){case"web":if(nabu.isValidURL(k)){b=2}break;case"email":if(nabu.isValidEmail(k)){b=2}break;case"ipv4":if(nabu.isValidIPv4(k)){b=2}break;case"phone":if(nabu.isValidPhoneNumber(k)){b=2}break}}break;case"same":if(c.length===2){var f=this.getFieldValue(c[1]);if((f===null||f===false||f==="")&&(k===null||k===false||k==="")){b=(d==="yes"?0:1)}else{if(f===k){b=2}else{b=0}}}break;case"checked":if(!(j instanceof NodeList)&&!(j instanceof HTMLCollection)&&!(j instanceof Array)&&j.checked&&j.checked===true){b=2}break;case"unchecked":if(!(j instanceof NodeList)&&!(j instanceof HTMLCollection)&&!(j instanceof Array)&&j.checked&&j.checked!==true){b=2}break}}return b},validateSameFields:function(a){var g,c;for(var b in this.fields){if(b!==a){g=this.fields[b];var f=(g.object.attributes&&g.object.attributes["data-form-rule"]?g.object.attributes["data-form-rule"].value:"none");if(f!==null&&f!=="none"){var d=f.split(":");if(d!==null&&d.length===2&&d[0]==="same"&&d[1]===a){this.evaluateField(b)}}}}},validateForm:function(){if(this.fields!==null){this.validate=true;for(var a in this.fields){field=this.fields[a];if(field.trigger===0){if(field.object instanceof NodeList||field.object instanceof Array){for(i=0;i<field.object.length;i++){if(this.isAvailableField(a)&&!field.object[i].disabled){this.validate=false}}}else{if(field.object instanceof HTMLCollection){for(i=0;i<field.object.length;i++){if(this.isAvailableField(a)&&!field.object.item(i).disabled){this.validate=false}}}else{if(this.isAvailableField(a)&&!field.object.disabled){this.validate=false}}}}}for(var a in this.fields){field=this.fields[a];if(field.object instanceof NodeList||field.object instanceof Array){for(i=0;i<field.object.length;i++){if(field.object[i].attributes&&field.object[i].attributes!==null&&field.object[i].attributes["data-form-follow"]&&this.isAvailableField(a)){this.fieldFollowsForm(field.object[i],field.object[i].attributes["data-form-follow"].value,this.validate)}}}else{if(field.object instanceof HTMLCollection){for(i=0;i<field.object.length;i++){if(field.object.item(i).attributes&&field.object.item(i).attributes!==null&&field.object.item(i).attributes["data-form-follow"]&&this.isAvailableField(a)){this.fieldFollowsForm(field.object.item(i),field.object.item(i).attributes["data-form-follow"].value,this.validate)}}}else{if(field.object.attributes!==null&&field.object.attributes["data-form-follow"]&&this.isAvailableField(a)){this.fieldFollowsForm(field.object,field.object.attributes["data-form-follow"].value,this.validate)}}}}return this.validate}return false},setFieldStatusClass:function(b,a){if(this.fields[b]){if(this.fields[b].object instanceof NodeList||this.fields[b].object instanceof Array){for(var c=0;c<this.fields[b].object.length;c++){var d=this.fields[b].object[c];this.setFieldStatusClassInternal(d,a)}}else{if(this.fields[b].object instanceof HTMLCollection){for(var c=0;c<this.fields[b].object.length;c++){var d=this.fields[b].object.item(c);this.setFieldStatusClassInternal(d,a)}}else{var d=this.fields[b].object;this.setFieldStatusClassInternal(d,a)}}}},setFieldStatusClassInternal:function(c,a){var b=null;if(!(c instanceof NodeList)&&!(c instanceof HTMLCollection)&&!(c instanceof Array)){b=this.params.reflection;if(b!==null){var d=$(c).closest("."+b);if(d.length>0){c=d.get(0)}}}$(c).removeClass(this.params.reflectionSuccess);$(c).removeClass(this.params.reflectionWarning);$(c).removeClass(this.params.reflectionError);switch(a){case 0:$(c).addClass(this.params.reflectionError);break;case 1:$(c).addClass(this.params.reflectionWarning);break;case 2:$(c).addClass(this.params.reflectionSuccess);break}},applyPlaceholder:function(b,a){if(nabu.getNavigatorName()==="MSIE"){if(b.attributes.placeholder){var c=b.attributes.placeholder.value;if(a){$(b).removeClass("placeholder");if(b.value===c){b.value="";b.focus()}}else{if(b.value.length===0||b.value===c){b.value=c;$(b).addClass("placeholder")}else{$(b).removeClass("placeholder")}}}}},addAction:function(f,a,g,d){if(this.fields[f]){var b={status:a,target:g,action:d,loop:0};if(this.fields[f].actions===null){this.fields[f].actions=new Array();this.fields[f].actions.push(b)}else{for(var c=0;c<this.fields[f].actions.length;c++){if(this.fields[f].actions[c].status===a&&this.fields[f].actions[c].target===g){this.fields[f].actions.splice(c,1);break}}this.fields[f].actions.push(b)}this.resetActionsFlag();this.applyActionsForField(f);this.validateSameFields(f);this.validateForm()}},addActions:function(b){if(b!==null&b.length>0){for(var a in b){this.addAction(b[a][0],b[a][1],b[a][2],b[a][3])}}},resetActionsFlag:function(){this.maskActions.id=new Array();this.maskActions.name=new Array()},maskAction:function(d,c,g,b){var a=null;if(this.fields[d]){if(!this.maskActions.name[d]){this.maskActions.name[d]={visible:null,enabled:null}}if(g!==null){this.maskActions.name[d].visible=(this.maskActions.name[d].visible===null?g:this.maskActions.name[d].visible&g)}if(b!==null){this.maskActions.name[d].enabled=(this.maskActions.name[d].enabled===null?b:this.maskActions.name[d].enabled&b)}a=this.maskActions.name[d]}else{if(document.getElementById(d)){if(!this.maskActions.id[d]){this.maskActions.id[d]={visible:null,enabled:null}}if(g!==null){this.maskActions.id[d].visible=(this.maskActions.id[d].visible===null?g:this.maskActions.id[d].visible&g)}if(b!==null){this.maskActions.id[d].enabled=(this.maskActions.id[d].enabled===null?b:this.maskActions.id[d].enabled&b)}a=this.maskActions.id[d]}}if(a!==null){if(c instanceof NodeList||c instanceof Array){for(var f=0;f<c.length;f++){this.applyMask(c[f],a)}}else{if(c instanceof HTMLCollection){for(var f=0;f<c.length;f++){this.applyMask(c.item(f),a)}}else{if(c!==null){this.applyMask(c,a)}}}}},applyMask:function(b,a){if(b!==null){if(a.enabled!==null){b.disabled=!a.enabled;if(!a.enabled){b.setAttribute("disabled","");$(b).addClass("disabled")}else{b.removeAttribute("disabled");$(b).removeClass("disabled")}}if(a.visible!==null){if(a.visible===true){$(b).removeClass("hidden");$(b).addClass("visible")}else{$(b).removeClass("visible");$(b).addClass("hidden")}}}},applyActionsForField:function(a){if(this.fields[a]&&this.fields[a].actions!==null){for(var b=0;b<this.fields[a].actions.length;b++){var d=this.fields[a].actions[b];if(d.loop===0){var g=d.status.split(":");var c=g===null?d.status:g[0];var f=(this.fields[d.target]?this.fields[d.target].object:document.getElementById(d.target));if(f&&f!==null){this.prependActionsForTarget(d);if(this.evalActions(c,a,d.status)){this.fields[a].actions[b].loop=1;g=d.action.split(":");c=g===null?d.action:g[0];this.applyActions(c,d,f);if(this.fields[d.target]){this.applyActionsForField(d.target)}this.fields[a].actions[b].loop=0}}}}}},applyActions:function(a,b,c){switch(a){case"hidden":this.applyHiddenAction(b.target,c);break;case"visible":this.applyVisibleAction(b.target,c);break;case"disabled":this.applyDisabledAction(b.target,c);break;case"enabled":this.applyEnabledAction(b.target,c);break;case"javascript":this.applyJavascriptAction(b);break;case"none":break;default:alert("Unkown action '"+a+"'");return}},applyHiddenAction:function(b,a){if(a!==null){this.maskAction(b,a,false,null)}},applyVisibleAction:function(b,a){if(a!==null){this.maskAction(b,a,true,null)}},applyDisabledAction:function(b,a){if(a!==null){this.maskAction(b,a,null,false)}},applyEnabledAction:function(b,a){if(a!==null){this.maskAction(b,a,null,true)}},applyJavascriptAction:function(action){var p=action.action.indexOf(":");if(p>=0){var js=action.action.substr(p+1);window.eval(js)}},evalActions:function(c,b,a){var d=this.isAvailableField(b);switch(c){case"unselected":return d?this.evalUnselectedAction(b):true;case"selected":return d?this.evalSelectedAction(b):true;case"value":return d?this.evalValueAction(b,a):true;case"valid":return d?this.evalValidAction(b):true;case"invalid":return d?!this.evalValidAction(b):false;case"checked":return d?this.evalCheckedAction(b):true;case"unchecked":return d?!this.evalCheckedAction(b):false;case"filled":return d?!this.evalFilledAction(b):true;case"empty":return d?!this.evalEmptyAction(b):false}throw"Unkown status ["+c+"]";return false},prependActionsForTarget:function(f){var h=false;for(var c in this.fields){if(this.fields[c].actions!==null&&this.fields[c].actions.length>0){for(var b=0;b<this.fields[c].actions.length;b++){var a=this.fields[c].actions[b];if(a.target===f.target&&(a.status!==f.status||a.action!==f.action)){var g=f.status.split(":");var d=g===null?f.status:g[0];if(this.evalActions(d,c,a.status)){h=true;g=a.action.split(":");d=g===null?a.action:g[0]}}}}}return h},evalUnselectedAction:function(a){if(this.fields[a].object.tagName.toLowerCase()==="select"&&this.fields[a].object.attributes["data-unselected-value"]){var c=this.fields[a].object.attributes["data-unselected-value"].value;var b=this.fields[a].object.options[this.fields[a].object.selectedIndex].value;return c===b}return false},evalSelectedAction:function(a){if(this.fields[a].object.tagName.toLowerCase()==="select"&&this.fields[a].object.attributes["data-unselected-value"]){var c=this.fields[a].object.attributes["data-unselected-value"].value;var b=this.fields[a].object.options[this.fields[a].object.selectedIndex].value;return c!==b}return false},evalValueAction:function(c,a){var g=a.indexOf(":");if(g>=0){var b=a.substr(g+1);var f=this.getFieldValue(c);if(f instanceof Array){for(var d=0;d<f.length;d++){if(f[d]===b){return true}}return false}else{return(f!==null&&f===b)}}return false},evalValidAction:function(a){return this.fields[a]?(this.fields[a].trigger>0):true},evalCheckedAction:function(a){return this.fields[a]&&this.fields[a].object!==null&&this.fields[a].object.checked!==undefined?this.fields[a].object.checked:true},evalEmptyAction:function(a){var c=this.getFieldValue(a);if(c instanceof Array){for(var b=0;b<c.length;b++){if(c[b].length===0){return false}}return false}else{return !(c===null||c.length===0)}return true},evalFilledAction:function(a){var c=this.getFieldValue(a);if(c instanceof Array){for(var b=0;b<c.length;b++){if(c[b].length>0){return true}}return false}else{return(c!==null&&c.length>0)}return false},refresh:function(){this.form.submit()},trigger:function(c){if(c!==null&&c.attributes.action){var a=c.attributes.action.value;var b=a.split(":");if(b!==null&&b.length>0){switch(b[0]){case"javascript":this.triggerJavascript(c,a);break;case"url":this.triggerHTTP(c,a);break}}}},triggerJavascript:function(obj,action){var p=action.indexOf(":");if(p>=0){var js=action.substr(p+1);eval(js)}},triggerHTTP:function(d,b){var c=b.indexOf(":");if(c>=0){var a=b.substr(c+1);document.location=a}},submitByAjax:function(r){var m,q="";var f=this;if(this.form!==null&&this.params.ajax===true){if(this.params.ajax_target!==null){var l=document.getElementById(this.params.ajax_target);if(l){$(l).addClass("sending")}else{$(this.form).addClass("sending")}}else{$(this.form).addClass("sending")}var p="application/x-www-form-urlencoded";if(this.params.enctype){p=this.params.enctype}else{if(this.form.encoding){p=this.form.encoding}else{if(this.form.contentType){p=this.form.enctype}}}var h=(p==="multipart/form-data");var u=(p==="application/json"||p==="text/json");if(h){var c=new FormData();for(m in this.fields){var l=this.fields[m].object;if(l!==null){if(l instanceof HTMLInputElement){if(l.attributes.type){var s=l.attributes.type.value;if(s==="file"){var b=(l.final_files?l.final_files:l.files);for(var g=0;g<b.length;g++){c.append(m+"["+g+"]",b[g])}}else{if(s!=="submit"&&s!=="image"){if((s!=="checkbox"&&s!=="radio")||l.checked){c.append(m,this.getFieldValue(m))}}}}}else{if(l instanceof HTMLSelectElement||l instanceof HTMLTextAreaElement||l instanceof NodeList||l instanceof HTMLCollection||l instanceof Array){c.append(m,this.getFieldValue(m))}else{if(!(l instanceof HTMLButtonElement)){throw"Object not found ["+l+" "+m+"]"}}}}}if((typeof r!=="undefined")&&r!==null&&r.attributes&&r.attributes.name){c.append(r.attributes.name.value,null)}}else{for(m in this.fields){var o=this.fields[m];var l=o.object;if(l!==null){if(l instanceof HTMLInputElement){if(l.attributes.type){var s=l.attributes.type.value;if(s!=="submit"&&s!=="image"){q+=(q.length===0?"":"&")+m+"="+encodeURIComponent(this.getFieldValue(m))}}}else{if(l instanceof HTMLSelectElement||l instanceof HTMLTextAreaElement||l instanceof NodeList||l instanceof HTMLCollection||l instanceof Array){q+=(q.length===0?"":"&")+m+"="+encodeURIComponent(this.getFieldValue(m))}else{if(!(l instanceof HTMLButtonElement)){throw"Object not found ["+l+" "+m+"]"}}}}}if(r!==undefined&&r!==null&&r.attributes&&r.attributes.name){q+=(q.length===0?"":"&")+r.attributes.name.value+"="}}var k=$(this.form).data();var d=(r.attributes&&r.attributes.formaction)?(r.attributes.formaction.value):(k.actionTemplate&&k.actionTemplate.length>0?((k.id)?$.sprintf(k.actionTemplate,k.id):$.sprintf(k.actionTemplate,"")):this.form.action);var a=k.ajaxMethod?k.ajaxMethod:this.form.method.toUpperCase();if(a==="GET"){d+=(d!==null&&d.indexOf("?")>=0?"&":"?")+q}var n=new Nabu.Ajax.Connector(d,a,{withCredentials:true,contentType:(h?null:p)});n.addEventListener(new Nabu.Event({onLoad:function(j){if(f.params.ajax_target!==null){var t=document.getElementById(f.params.ajax_target);if(t){$(t).removeClass("sending");t.innerHTML=j;nabu.callJavaScript(t)}}if(f.params.ajax_onload!==null){window[f.params.ajax_onload]({form:f,response:j})}$(f.form).removeClass("sending");f.events.fireEvent("onSubmit",f,{response:j.params})},onError:function(){var j=document.getElementById(f.params.ajax_target);if(j){$(j).removeClass("sending")}f.events.fireEvent("onError",f)},onUploadProgress:function(j,t){if(f.params.ajax_on_upload_progress!==null){window[f.params.ajax_on_upload_progress]({form:f,response:t})}}}));if(h){n.setPostStream(c)}else{n.setPostStream(q)}n.execute()}},getSubmitButton:function(c){var a=this.submit_object!==null?this.submit_object:(c.explicitOriginalTarget?c.explicitOriginalTarget:null);if(a===null||(a.attributes.type&&a.attributes.type.value!=="submit")){for(var b in this.fields){var b=this.fields[b].object;if(b.attributes){if((b.attributes.type&&b.attributes.type.value==="submit")||(b.attributes.action&&b.attributes.action.value==="submit")){a=b;break}}}}return a},onSubmit:function(d){if(this.events.isEventTargeted("onBeforeSubmit")){this.events.fireEvent("onBeforeSubmit",this)}if(this.formaction!==null&&nabu.getNavigatorName()==="MSIE"){this.form.action=this.formaction}this.formaction=null;var a=this.getSubmitButton(d);if(this.params.ajax===true){this.submitByAjax(a);d.stopPropagation();return false}else{var c=$(this.form).data();var b=(a.attributes&&a.attributes.formaction)?(a.attributes.formaction.value):(c.actionTemplate&&c.actionTemplate.length>0?((c.id)?$.sprintf(c.actionTemplate,c.id):$.sprintf(c.actionTemplate,"")):this.form.action);$(this.form).attr("action",b);$(this.container).addClass("sending");return true}},onChangeField:function(c){var b=c.target;var a=this.validateField(b.name);this.setFieldStatusClass(b.name,a);this.resetActionsFlag();this.applyActionsForField(b.name);if(b.attributes.refresh&&b.attributes.refresh.value==="yes"){this.refresh();a=0}else{this.validateSameFields(b.name);this.validateForm()}this.events.fireEvent("onFieldChange",this,{field:b.name,value:$(b).val()});return(a!==0)},onFocusField:function(b){var a=b.target;this.applyPlaceholder(a,true)},onBlurField:function(c){var b=c.target;var a=this.validateField(b.name);this.setFieldStatusClass(b.name,a);this.resetActionsFlag();this.applyActionsForField(b.name);this.validateSameFields(b.name);this.validateForm();this.applyPlaceholder(b,false);return(a!==0)},onClickField:function(d){var c=d.target;if(!c.inClickForm){c.inClickForm=true;if(c.attributes.type&&c.attributes.type.value.toLowerCase()==="submit"){this.submit_object=c}var b=this.validateField(c.name);this.setFieldStatusClass(c.name,b);this.resetActionsFlag();this.applyActionsForField(c.name);if(b!==0){if(c.attributes.action){this.trigger(c)}}if(c.attributes.formaction){this.formaction=c.attributes.formaction.value}this.validateSameFields(c.name);this.validateForm();if(c.attributes.type){var a=c.attributes.type.value.toLowerCase();if(a==="checkbox"){this.events.fireEvent("onFieldChange",this,{field:c.name,value:c.checked?$(c).val():$(c).data("valueUnchecked")})}}c.inClickForm=false}return true},onKeyUp:function(c){var b=c.target;var a=this.validateField(b.name);this.setFieldStatusClass(b.name,a);this.resetActionsFlag();this.applyActionsForField(b.name);if(b.attributes.refresh&&b.attributes.refresh.value==="yes"){this.refresh();return false}this.validateSameFields(b.name);this.validateForm();return(a!==0)}};nabu.registerLibrary("Form",["Event","Ajax"]);