try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(typeof Nabu.UI==="undefined"){Nabu.UI=function(){}}Nabu.UI.Table=function(a,c){this.events=new Nabu.EventPool();this.container=a;this.params=c;this.currentPage=1;try{this.table=$(a).find("table").get(0)}catch(b){this.table=null}this.init()};Nabu.UI.Table.prototype={addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},init:function(){this.initUI();this.initPager();this.initEditButtonStyle();this.initSelectableCheckbox();this.initToolbar()},initUI:function(){var a=this;$(window).resize(function(){var b=$(a.container).find('tbody tr[data-type="row"]:first').children();var c=b.map(function(){return $(this).width()}).get();$(a.container).find("thead tr").children().each(function(f,d){$(d).width(c[f])})}).resize()},initPager:function(){var j=this;$(this.container).find(".table-pager").remove();if(this.params.tablePager&&this.params.tableSize>0){var h=$(this.container).find('tbody > tr:not([data-type="empty"])');var f=Math.ceil(h.length/this.params.tableSize);var a=this.currentPage>2?this.currentPage-2:1;var d=a+4>f?f:a+4;a=d-a<5?(d>4?d-4:1):a;if(f>1){var c='<div class="table-pager"><nav aria-label="Page navigation"><ul class="pagination"><li'+(this.currentPage===1?' class="disabled"':"")+'><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>';for(var b=a;b<=d;b++){c+="<li"+(b===this.currentPage?' class="active"':"")+' data-page="'+b+'"><a href="#">'+b+"</a></li>"}c+="<li"+(this.currentPage===f?' class="disabled"':"")+'><a href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li></ul></nav></div>';$(this.container).append(c);pager=$(this.container).find(".table-pager");if(this.currentPage>1){pager.find("li:first-child > a").on("click",function(i){i.preventDefault();if(j.currentPage>1){j.currentPage--;j.initPager()}})}if(this.currentPage<f){pager.find("li:last-child > a").on("click",function(i){i.preventDefault();if(j.currentPage<f){j.currentPage++;j.initPager()}})}pager.find("li[data-page]").on("click",function(i){i.preventDefault();j.currentPage=$(this).data("page");j.initPager()});for(var b=0;b<h.length;b++){var g=Math.ceil((b+1)/this.params.tableSize);if(g===this.currentPage){$(h[b]).removeClass("hide")}else{$(h[b]).addClass("hide")}}}else{h.removeAttr("hide")}}},initEditButtonStyle:function(){var a=this;if(this.params.editButton==="button"){$(this.container).find(".btn-editor").unbind("click").on("click",function(b){return a.doEditButtonClick(b)})}else{if(this.params.editButton==="line"){$(this.container).find("tr[data-id]").unbind("click").on("click",function(b){return a.doEditButtonClick(b)})}}},initSelectableCheckbox:function(){var a=this;$(this.container).find('thead th[data-toggle="table-selectable"] input[type="checkbox"]').unbind("click").on("click",function(b){return a.doSelectableHeadCheckbox(b)});$(this.container).find('tbody td[data-toggle="table-selectable"] input[type="checkbox"]').unbind("click").on("click",function(b){return a.doSelectableBodyCheckbox(b)})},initToolbar:function(){var a=this;$(this.container).find(".table-toolbar .btn").on("click",function(c){var b=$(this).data();if(b.action){a.events.fireEvent("onToolbarClick",a,{action:b.action,selection:a.getSelectedItems()})}if(!b.toggle){c.preventDefault();return false}else{return true}});this.enableToolbarButtons()},enableToolbarButtons:function(){var b=$(this.container).find(".table-toolbar");if(b.length>0){var a=this.getSelectedItems();b.find(".btn").attr("disabled","disabled");if(a!==null){if(a.length===1){b.find('[data-apply="all"], [data-apply="single"], [data-apply="multiple"]').removeAttr("disabled")}else{if(a.length>1){b.find('[data-apply="all"], [data-apply="multiple"]').removeAttr("disabled")}}}else{b.find('[data-apply="all"]').removeAttr("disabled")}}},doEditButtonClick:function(a){var b=false;if(this.params.editButton==="line"){b=$(a.currentTarget).data("id")}else{if(this.params.editButton==="button"){b=$(a.currentTarget).closest("[data-id]").data("id")}else{throw Exception("Invalid editButton value ["+b+"]")}}this.editor(b)},editor:function(d){var f=this;var a=((typeof d)==="undefined");var g=a?$.sprintf(this.params.editor,""):$.sprintf(this.params.editor,d);if(this.params.editorMode==="ajax"&&this.params.editorContainer.length>0){if(a){var b="new_"+(new Date().getTime())+""+Math.floor(Math.random()*900)+100;this.hideEmptyMessage();this.appendRow(b);this.initSelectableCheckbox();this.initEditButtonStyle()}else{this.editRow(d)}var c=$("#"+this.params.editorContainer);if(c.length>0){c.find("[id^="+this.params.editorContainer+"_]").addClass("hide")}var j=c.find(".myst");j.removeClass("hide");var h=a?[]:c.find("[id="+this.params.editorContainer+"_"+d+"]");if(h.length>0){var i=f.params.editorContainer+"_"+(a?b:d);h.removeClass("hide");j.addClass("hide");$(this.table).find("tr").removeClass("editing");$(this.table).find('tr[data-id="'+d+'"]').addClass("editing");f.events.fireEvent("onShownEditor",f,{id:(a?b:d),container_id:i})}else{nabu.loadLibrary("Ajax",function(){var k=new Nabu.Ajax.Connector(g,"GET");k.addEventListener(new Nabu.Event({onLoad:function(n){var l=f.params.editorContainer+"_"+(a?b:d);var o=document.createElement("DIV");o.id=l;o.innerHTML=n.params.text;c.append(o);if(a){var m=c.find("form[data-multiform-part]");m.each(function(){var p=$(this).data("multiform-part");$(this).attr("data-multiform-part",$.sprintf(p,b));$(this).data("multiform-part",$.sprintf(p,b))})}$(f.table).find("tr").removeClass("editing");$(f.table).find('tr[data-id="'+(a?b:d)+'"]').addClass("editing");f.events.fireEvent("onLoadEditor",f,{id:(a?b:d),container_id:l});j.addClass("hide")},onError:function(l){j.addClass("hide")}}));k.execute()})}}else{if(this.params.editorMode==="page"){document.location=g}}return false},appendRow:function(c){if(this.table!==null){var g=this.table.insertRow(this.table.rows.length);$(g).attr("data-id",c);if(this.params.editButton==="line"){$(g).addClass("btn-edit-line")}if(this.table.tHead.rows.length>0){var b=this.table.tHead.rows[0];for(var d=0;d<b.cells.length;d++){var f=b.cells[d];var a=g.insertCell();if(f.hasAttribute("data-toggle")&&f.getAttribute("data-toggle")==="table-selectable"){a.setAttribute("data-toggle","table-selectable");a.innerHTML='<input type="checkbox">'}if(f.hasAttribute("class")){a.setAttribute("class",f.getAttribute("class"))}if(f.hasAttribute("data-name")){a.setAttribute("data-name",f.getAttribute("data-name"))}if(f.hasAttribute("data-align")){$(a).addClass(f.getAttribute("data-align"))}if(f.hasAttribute("data-is-id")&&f.getAttribute("data-is-id")==="true"){$(a).html('<i class="fa fa-plus text-danger edited pull-left"></i>')}}}}},editRow:function(c){if(this.table!==null){var a=$(this.table).find('tbody tr[data-id="'+c+'"]').get(0);var b=this.table.tHead.rows[0];if(a.cells.length===b.cells.length){for(var d=0;d<b.cells.length;d++){var g=b.cells[d];if($(g).data("is-id")){var f=a.cells[d];if($(f).find(".edited").length===0){$('<i class="fa fa-pencil text-danger edited pull-left"></i>').insertBefore($(f).children().get(0))}}}}}},getCell:function(a,b){if(this.table!==null){return $(this.table).find('tbody tr[data-id="'+a+'"] td[data-name="'+b+'"]').html()}return null},doSelectableHeadCheckbox:function(c){c.stopPropagation();var a=$(this.container).find('tbody td[data-toggle="table-selectable"] input[type="checkbox"]');var b=$(c.currentTarget);if(c.currentTarget.checked){a.prop("checked",true)}else{a.prop("checked",false)}this.enableToolbarButtons();return true},doSelectableBodyCheckbox:function(d){d.stopPropagation();var b=$(this.container).find('thead th[data-toggle="table-selectable"] input[type="checkbox"]');var c=$(this.container).find('tbody td[data-toggle="table-selectable"] input[type="checkbox"]').length;var a=$(this.container).find('tbody td[data-toggle="table-selectable"] input[type="checkbox"]:checked').length;b.prop("checked",(c===a));this.enableToolbarButtons();return true},getSelectedItems:function(){var a=[];$(this.container).find('tbody td[data-toggle="table-selectable"] input[type="checkbox"]:checked').closest("tr").each(function(b){if($(this).data("id")){a.push($(this).data("id"))}});return a.length>0?a:null},connectForm:function(d,a){var b=$(a);if(b.length===1){var c=b.get(0);if(c.nabuForm){var f=this;c.nabuForm.addEventListener(new Nabu.Event({onFieldChange:function(h,k){var j=$(f.table).find('thead th[data-name="'+h.params.field+'"]');if(j.length===1){var i=h.params.value;var g=j.data("lookup");if((typeof g)!=="undefined"){i=g[h.params.value]}$(f.table).find('tbody tr[data-id="'+d+'"] td[data-name="'+h.params.field+'"]').text(i)}}}))}else{console.log("Nabu.Form object not found")}}else{if(b.length>1){console.log("More than one forms found with same identifier ["+a+"]")}}},hideEmptyMessage:function(){$(this.container).find('tbody > tr[data-type="empty"]').addClass("hide")}};nabu.registerLibrary("Table",["Event","Ajax"]);