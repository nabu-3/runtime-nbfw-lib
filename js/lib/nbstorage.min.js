try{if(!Nabu)throw"Nabu Manager not loaded"}catch(e){throw"Nabu Manager not loaded"}Nabu.Storage=function(e){if(!0!==e&&!1!==e)throw new Exception("[permanent] value not falid");this.available=!1,this.permanent=e,this.storage=null,this.events=new Nabu.EventPool,this.init()},Nabu.Storage.prototype={init:function(){try{var e=window[this.permanent?"localStorage":"sessionStorage"],t="__storage_test__";e.setItem(t,t),e.removeItem(t),this.storage=e,this.available=!0}catch(e){this.storage=null,this.available=!1}},getValue:function(e,t){var n=null;if(!this.available||null===this.storage){if(this.events.isEventTargeted("onError"))return this.events.fireEvent("onError",this,{error:"Storage not available"}),null;throw"Storage not available. Unrecoverable value for "+e}return null!==(n=this.storage.getItem(e))?("function"==typeof t&&(n=t(n)),this.events.isEventTargeted("onExists")&&this.events.fireEvent("onExists",this,{key:e,value:n}),n):this.events.isEventTargeted("onCreate")?this.events.fireEvent("onCreate",this,{key:e}):void 0},getObject:function(e){return this.getValue(e,function(e){return"string"==typeof e?JSON.parse(e):null})},setValue:function(e,t){this.available&&null!==this.storage&&(this.storage.setItem(e,t),this.events.isEventTargeted("onSetted")&&this.events.fireEvent("onSetted",this,{key:e,value:t}))},setObject:function(e,t){"object"==typeof t&&this.setValue(e,JSON.stringify(t))},addEventListener:function(e){this.events.addEventListener(e)},removeEventListener:function(e){this.events.removeEventListener(e)}},nabu.registerLibrary("Storage",["Event"]);