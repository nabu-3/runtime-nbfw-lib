try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}Nabu.Storage=function(a){if(a!==true&&a!==false){throw new Exception("[permanent] value not falid")}this.available=false;this.permanent=a;this.storage=null;this.events=new Nabu.EventPool();this.init()};Nabu.Storage.prototype={init:function(){try{var c=window[this.permanent?"localStorage":"sessionStorage"];var a="__storage_test__";c.setItem(a,a);c.removeItem(a);this.storage=c;this.available=true}catch(b){this.storage=null;this.available=false}},getValue:function(a,c){var b=null;if(this.available&&this.storage!==null){if((b=this.storage.getItem(a))!==null){if((typeof c)==="function"){b=c(b)}if(this.events.isEventTargeted("onExists")){this.events.fireEvent("onExists",this,{key:a,value:b})}return b}}else{if(this.events.isEventTargeted("onError")){this.events.fireEvent("onError",this,{error:"Storage not available"});return null}else{throw"Storage not available. Unrecoverable value for "+a}}if(this.events.isEventTargeted("onCreate")){return this.events.fireEvent("onCreate",this,{key:a})}},getObject:function(a){return this.getValue(a,function(b){if((typeof b)==="string"){return JSON.parse(b)}return null})},setValue:function(a,b){if(this.available&&this.storage!==null){this.storage.setItem(a,b);if(this.events.isEventTargeted("onSetted")){this.events.fireEvent("onSetted",this,{key:a,value:b})}}},setObject:function(a,b){if((typeof b)==="object"){this.setValue(a,JSON.stringify(b))}},addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)}};nabu.registerLibrary("Storage",["Event"]);